{
  "title": "How to Clean Crypto Datasets Before Filing: Tax Data Engineering Guide 2025",
  "excerpt": "Professional guide to clean, debug, and prepare your cryptocurrency data before filing your tax return. Learn data engineering techniques applied to crypto taxation so you can obtain accurate reports for the Spanish Tax Agency (AEAT).",
  "seo": {
    "metaTitle": "How to Clean Crypto Datasets Before Filing: Complete Guide 2025 | Cleriontax",
    "metaDescription": "Learn how to clean and prepare your cryptocurrency datasets for your tax return. Professional data engineering techniques to clean CSVs, remove duplicates, and correct errors before filing with the AEAT.",
    "keywords": [
      "clean cryptocurrency data",
      "debug crypto CSV",
      "prepare data for tax return",
      "tax data engineering",
      "clean crypto history",
      "crypto data cleaning",
      "exchange CSV errors",
      "duplicate crypto transactions",
      "normalize tax data",
      "crypto ETL",
      "prepare AEAT crypto",
      "consolidate wallets and exchanges",
      "crypto tax datasets",
      "blockchain data cleaning"
    ]
  },
  "content": "The difference between a correct cryptocurrency tax return and one that causes problems with the Tax Authority does not lie only in knowing the regulations. In practice, the real challenge is the quality of the data you use to calculate your capital gains and losses. After exporting your history from different exchanges and wallets, you end up with a set of CSV files that, in their raw state, contain inconsistencies, duplicates, empty fields, and incompatible formats that will make it impossible to correctly calculate the mandatory FIFO method in Spain.\n\nAt Cleriontax we apply data engineering methodologies to every tax report we prepare, because we know that a dirty dataset produces wrong results regardless of how good the calculation tool is. This article will teach you how to prepare your data the way we do, applying professional cleaning and normalization techniques that ensure the accuracy of your return before the AEAT.\n\n---\n\n## Why data cleaning is critical for your tax return\n\nWhen you export your transaction history from Binance, Coinbase, Kraken or any exchange, you get CSV files that were designed for internal use by each platform, not for tax compliance. Each exchange uses its own format, its own names for transaction types, and its own criteria for recording trades. If you also have activity in wallets like Metamask and have exported data from blockchain explorers, the heterogeneity of formats multiplies exponentially.\n\nThe fundamental problem is that the AEAT requires precise, chronologically ordered data expressed in euros to correctly apply the FIFO method. A single duplicate in your data can completely distort the acquisition cost of your cryptocurrencies, generating incorrect capital gains or losses.\n\n### Most frequent errors in raw datasets\n\n| Error type | Tax consequence | Frequency |\n|---|---|---|\n| Duplicate transactions | Double counting, incorrect FIFO | Very high |\n| Dates in incompatible formats | Wrong tax year, incorrect ordering | High |\n| Misclassified internal operations | Fictitious capital gains | High |\n| Values not converted to EUR | Calculations in mixed currencies | Medium |\n| Empty or null fields | Errors in formulas and calculations | Medium |\n| Different names for the same concept | Incorrect tax classification | High |\n\nEach of these issues, if not corrected before calculating capital gains, can result in an incorrect tax return with the corresponding penalties from the Tax Authority.\n\n---\n\n## Phase 1: Inventory and initial audit of data sources\n\nBefore modifying any file, it is essential to create a complete inventory of all the data sources you need to consolidate. This initial audit phase determines the scope of the cleaning work and allows you to identify potential information gaps.\n\nStart by creating an exhaustive list of all exchanges where you have traded during the tax year, including platforms you no longer use but where you carried out operations in the period to be reported. For each exchange, identify which types of export you have generated by following the specific guides for each platform. If you have not completed the export from any exchange, we recommend checking our [guide to correctly export your Binance history](/blog/como-exportar-historial-binance-correctamente) as a methodological reference.\n\n### Source inventory checklist\n\n**Centralized exchanges:**\n- Identify all platforms used (active and inactive)\n- Verify that all types of history have been exported (trades, staking, earn, conversions)\n- Document the date range of each export\n- Note the format of each file (CSV, XLSX, JSON)\n\n**Non-custodial wallets:**\n- List all wallet addresses used\n- Identify the blockchains where each wallet has activity\n- Verify exports from Etherscan, Polygonscan, etc.\n- Include both transactions and token transfers\n\n**Recommended folder structure:**\n\n```\nðŸ“ Tax_Data_2024/\nâ”œâ”€â”€ ðŸ“ 01_Original_Intact/\nâ”‚   â”œâ”€â”€ ðŸ“ Binance/\nâ”‚   â”œâ”€â”€ ðŸ“ Coinbase/\nâ”‚   â”œâ”€â”€ ðŸ“ Metamask_ETH/\nâ”‚   â””â”€â”€ ðŸ“ Metamask_Polygon/\nâ”œâ”€â”€ ðŸ“ 02_In_Progress/\nâ””â”€â”€ ðŸ“ 03_Final_Consolidated/\n```\n\nAlways keep an untouched copy of the exported files before making any changes. This is essential both for internal audits and for potential AEAT inquiries where you may need to demonstrate the traceability of your calculations.\n\n---\n\n## Phase 2: Normalizing date and time formats\n\nDate formats are one of the most frequent and potentially serious problems in cryptocurrency datasets. Each exchange uses its own format, and the differences may seem subtle but have significant consequences for tax calculations.\n\n### Date formats by platform\n\n| Platform | Original format | Example | Time zone |\n|---|---|---|---|\n| Binance | YYYY-MM-DD HH:MM:SS | 2024-06-15 14:32:18 | UTC |\n| Coinbase | ISO 8601 | 2024-06-15T14:32:18Z | UTC |\n| Kraken | Unix timestamp | 1718458338 | UTC |\n| Etherscan | Unix timestamp | 1718458338 | UTC |\n| Bitstamp | DD/MM/YYYY HH:MM | 15/06/2024 14:32 | CET |\n\nWhen these files are combined without normalization, chronological sorting can produce completely incorrect results because the software interprets the fields differently.\n\n### Date normalization protocol\n\nThe process must follow these steps in strict order:\n\n1. **Identify the format** of each source file and document it explicitly\n2. **Convert all formats** to ISO 8601 (YYYY-MM-DDTHH:MM:SS) because of its natural sortability\n3. **Adjust time zone** to Spain (CET/CEST depending on the date)\n4. **Verify the conversion** by comparing known dates with the original record\n\n> **Critical time zone example:**\n>\n> A transaction on Etherscan: `2024-12-31 23:30:00 UTC`\n>\n> Converted to Spain (winter time): `2025-01-01 00:30:00 CET`\n>\n> **Tax year:** 2025, not 2024\n\nThis difference determines in which tax year the transaction must be reported, which can have significant implications if it is a material capital gain or loss.\n\n---\n\n## Phase 3: Detecting and removing duplicates\n\nDuplicate transactions are the most common and one of the most harmful errors in cryptocurrency datasets. They arise mainly from exports with overlapping date ranges and from operations that appear recorded in multiple ways in different export types from the same exchange.\n\nTo correctly detect duplicates, it is not enough to compare identical rows. You must implement an identification logic based on key fields that define the uniqueness of each transaction.\n\n### Key fields to identify duplicates\n\n**In centralized exchanges:**\n- Exact date and time (down to seconds)\n- Trading pair (BTC/EUR, ETH/USDT, etc.)\n- Transaction type (buy, sell, trade)\n- Executed amount\n- Execution price\n\n**In blockchain transactions:**\n- Transaction hash (txHash) â†’ definitive unique identifier\n- If there is no hash: combination of block + from + to + value\n\n### Three-pass deduplication process\n\n| Pass | Criterion | Action |\n|---|---|---|\n| **First** | Rows 100% identical | Automatically delete |\n| **Second** | Key fields match, secondary columns differ | Delete while keeping the row with more information |\n| **Third** | Similar but not identical transactions | Manual case-by-case review |\n\n**Example of a subtle duplicate:**\n\n```\nRow 1: 2024-06-15 14:32:18 | BTC/EUR | BUY | 0.05 | 62450.00 | fee: 0.0001\nRow 2: 2024-06-15 14:32:18 | BTC/EUR | BUY | 0.05 | 62450.00 | fee: (empty)\n```\n\nBoth represent the same transaction, but one has the fee and the other does not. Pass 2 should keep row 1.\n\nKeep a record of all duplicates removed. This log serves as documentation of the cleaning process and allows you to verify that legitimate operations have not been deleted by mistake. If you work with analysis tools like those described in our [guide to tools for tracking cryptocurrencies](/blog/herramientas-rastrear-criptomonedas), many include duplicate detection features you can use for cross-checking.\n\n---\n\n## Phase 4: Classifying and standardizing transaction types\n\nEach exchange uses its own terminology to describe transaction types. What Binance calls \"SPOT Trade\" may appear as \"Trade\" on Coinbase, \"Exchange\" on Kraken, or simply \"Buy\" on other platforms. To correctly apply the tax treatment to each transaction, you need a standardized classification system.\n\n### Mapping table: original names â†’ tax category\n\n| Original name | Exchange | Standardized tax category |\n|---|---|---|\n| SPOT Trade, Trade, Exchange | Various | Swap / Capital gain |\n| Buy, Purchase, Compra | Various | Acquisition |\n| Sell, Venta | Various | Disposal / Capital gain |\n| Convert, Conversion, Swap | Various | Swap / Capital gain |\n| Deposit, Ingreso | Various | Internal movement (verify origin) |\n| Withdrawal, Retiro | Various | Internal movement (verify destination) |\n| Staking Reward, Interest | Various | Investment income |\n| Airdrop, Distribution | Various | Income (value at market price) |\n| Fee, Commission, Gas | Various | Deductible expense |\n\n### Main tax categories\n\nCorrect classification of each transaction determines its tax treatment:\n\n- **Capital gains/losses:** Sales, swaps between cryptos, payments with crypto\n- **Investment income:** Staking, lending, farming, airdrops\n- **Internal movements:** Transfers between your own wallets (not taxable)\n- **Deductible expenses:** Commissions, gas fees, trading fees\n\nA frequent error is to classify transfers between your own wallets as sales, which generates fictitious capital gains. To go deeper into the classification criteria according to the AEAT, we recommend reading our article on [how to classify cryptocurrency transactions](/blog/clasificar-operaciones-criptomonedas).\n\n---\n\n## Phase 5: Converting values to euros\n\nThe AEAT requires that all transactions be reported in euros, valued at the exchange rate at the exact moment of each transaction. This requirement implies a conversion process that must be carried out accurately and with documented pricing sources.\n\n### Recommended pricing sources\n\n| Asset type | Primary source | Alternative source | Granularity |\n|---|---|---|---|\n| BTC, ETH, top 20 | CoinGecko API | CoinMarketCap | Minutes |\n| Liquid altcoins | CoinGecko API | Exchange where traded | Hours |\n| Illiquid tokens | Price on exchange | DEX (Uniswap, etc.) | Transaction |\n| USD stablecoins | EUR/USD exchange rate | ECB or OANDA | Daily |\n\n### Conversion process for crypto-to-crypto transactions\n\nFor transactions carried out in crypto-crypto pairs, you need a two-step conversion:\n\n**Example: Swap ETH â†’ LINK on Uniswap**\n\n```\n1. Original transaction:\n   - Sent: 2 ETH\n   - Received: 150 LINK\n   - Date: 2024-07-20 15:45:00 UTC\n\n2. Step 1 â€“ Value ETH in EUR:\n   - ETH price on 2024-07-20 15:45: 3,200 â‚¬\n   - Value sent: 2 Ã— 3,200 = 6,400 â‚¬\n\n3. Step 2 â€“ Value LINK in EUR:\n   - LINK price on 2024-07-20 15:45: 42.50 â‚¬\n   - Value received: 150 Ã— 42.50 = 6,375 â‚¬\n\n4. Tax result:\n   - Disposal value: 6,375 â‚¬ (what you receive)\n   - If ETH acquisition cost was 5,000 â‚¬:\n   - Capital gain: 6,375 - 5,000 = 1,375 â‚¬\n```\n\nThe process must document the source of each price used. This is especially important for high-value trades where a difference in pricing can mean thousands of euros difference in the calculated capital gain.\n\nAt [Cleriontax](/servicios) we use our own validated historical price databases that allow us to apply accurate conversions even for illiquid tokens.\n\n---\n\n## Phase 6: Handling empty fields and anomalous values\n\nEmpty fields and anomalous values in cryptocurrency datasets can have several legitimate causes, but they can also indicate export issues that require correction. Handling these cases must be done carefully so as not to delete valid information or propagate errors.\n\n### Interpreting empty fields\n\n| Empty field | Likely interpretation | Action |\n|---|---|---|\n| Fee / Commission | Promotion without fee or fee in another token | Verify; if correct â†’ 0 |\n| Price | Serious export error | Check original history |\n| Amount | Serious export error | Check original history |\n| Transaction hash | Normal in centralized exchanges | Acceptable |\n| Notes / Memo | Optional field not used | Ignore |\n\n### Detecting anomalous values\n\nImplement automatic validations that flag suspicious values:\n\n- **Implicit price Â±20% vs market:** Flag for manual review\n- **Negative amounts:** Sign error, correct\n- **Dates out of range:** Corrupted export, re-export\n- **Fees higher than 10% of value:** Verify (may be legitimate on congested networks)\n\n**Example of a legitimate anomaly:**\n\n```\nTransaction: Swap 0.01 ETH â†’ 50 USDC\nDate: 2024-05-15 (network congestion due to memecoin)\nGas fee: 0.008 ETH (80% of the traded value)\n\nâ†’ It looks anomalous but is correct. Document and keep.\n```\n\nEach anomaly must be investigated individually to determine whether it represents an error that needs to be corrected or an atypical but legitimate transaction.\n\n---\n\n## Phase 7: Consolidating multiple sources\n\nOnce each source file has been normalized individually, the next step is to consolidate all the data into a single dataset that represents all your cryptocurrency activity during the tax period.\n\n### Unified column schema\n\n| Column | Type | Mandatory | Description |\n|---|---|---|---|\n| fecha_hora | datetime | Yes | ISO 8601, Spain time zone |\n| tipo_operacion | string | Yes | Standardized tax category |\n| cripto_enviada | string | Depending on type | Symbol of the asset sold/sent |\n| cantidad_enviada | decimal | Depending on type | Amount of the asset sent |\n| cripto_recibida | string | Depending on type | Symbol of the asset bought/received |\n| cantidad_recibida | decimal | Depending on type | Amount of the asset received |\n| valor_eur | decimal | Yes | Transaction value in EUR |\n| fee_eur | decimal | Yes | Total fee in EUR |\n| fuente | string | Yes | Source exchange/wallet |\n| hash_tx | string | No | Blockchain hash if applicable |\n| notas | string | No | Comments on the process |\n\n### Consolidation process\n\n1. **Add an origin column** to each record before combining\n2. **Unify column names** according to the standard schema\n3. **Combine all files** into a single dataset\n4. **Sort chronologically** by fecha_hora\n5. **Run a final deduplication** in case there are cross-recorded operations\n\nIf consolidation and FIFO calculation are complex for you, our [portfolio analysis service](/servicios/analisis-carteras) includes the entire cleaning, normalization, and calculation process with professional verification at every step.\n\n---\n\n## Phase 8: Cross-validation and integrity checks\n\nBefore using the clean dataset to calculate your tax return, it is essential to perform cross-validation to verify the integrity of the processed data.\n\n### Three mandatory checks\n\n**1. Control balance**\n\nCalculate the final balance of each cryptocurrency according to your dataset and compare it with the real balance:\n\n```\nBalance according to dataset BTC: 0.5423 BTC\nReal balance in exchanges + wallets: 0.5420 BTC\nDifference: 0.0003 BTC (0.05%)\n\nâ†’ Acceptable difference due to rounding\n```\n\nDifferences greater than 1% require investigation.\n\n**2. Transaction count**\n\n```\nTotal original records: 2,847\nDocumented duplicates removed: 156\nRecords in final dataset: 2,691\n\n2,847 - 156 = 2,691 âœ“ Checks out\n```\n\n**3. Temporal consistency**\n\nCheck that there are no unexplained temporal gaps. If you traded actively all year but your dataset shows months with no activity, this may indicate incomplete exports.\n\nThis validation phase is where a [professional tax filing service](/servicios/liquidaciones-fiscales) adds the most value, as experience allows us to identify error patterns that an occasional user might miss.\n\n---\n\n## Tools to automate cleaning\n\nFor users with high transaction volumes, manual processing can be impractical. These tools help automate part of the process:\n\n### Tool comparison\n\n| Tool | Recommended volume | Technical level | Cost |\n|---|---|---|---|\n| Excel / Google Sheets | < 2,000 tx | Basic | Free |\n| Google Sheets + QUERY | < 5,000 tx | Intermediate | Free |\n| Python + pandas | Unlimited | Advanced | Free |\n| Koinly / CoinTracking | < 10,000 tx | Basic | Paid |\n\n**For Excel/Sheets:**\n- REMOVE.DUPLICATES function for pass 1\n- Pivot tables for total verification\n- VLOOKUP to add prices\n- Conditional formatting to detect anomalies\n\n**For technical users (Python):**\n\n```python\nimport pandas as pd\n\n# Load and combine sources\ndf = pd.concat([binance_df, coinbase_df, etherscan_df])\n\n# Normalize dates\ndf['fecha'] = pd.to_datetime(df['fecha'], utc=True)\ndf['fecha'] = df['fecha'].dt.tz_convert('Europe/Madrid')\n\n# Remove duplicates by key fields\ndf = df.drop_duplicates(subset=['fecha', 'par', 'tipo', 'cantidad'])\n\n# Sort chronologically\ndf = df.sort_values('fecha')\n```\n\nCrypto tax tools such as Koinly include built-in cleaning features, but they apply their own criteria, which may not match the AEAT requirements exactly. We recommend using them as a complement for cross-checking.\n\n---\n\n## Documenting the cleaning process\n\nEvery decision taken during the cleaning process must be documented. This documentation serves to reproduce the process if you need to recalculate it, provides evidence for potential AEAT inquiries, and facilitates review by third parties.\n\n### Contents of the methodology document\n\n- Full inventory of sources with export dates\n- Normalization criteria applied to each type of field\n- Mapping table of transaction types\n- Pricing sources used for EUR conversion\n- Record of duplicates removed with justification\n- Anomalies detected and how they were handled\n- Results of integrity checks\n\nAlso keep all intermediate files from the process, not just the originals and the final result. If you later detect an error, the intermediate files allow you to identify in which phase it was introduced.\n\nIn our [portfolio monitoring services](/servicios/seguimiento-cartera), we include full documentation of the analysis process delivered together with the tax report, ensuring complete traceability.\n\n---\n\n## Critical errors you must avoid\n\nThere are errors in the cleaning process that have especially serious consequences:\n\n### 1. Deleting legitimate transactions as \"duplicates\"\n\nIn active trading it is common to execute multiple transactions in the same pair within short time intervals. Check that the transactions are truly identical before deleting them.\n\n### 2. Incorrect currency conversions\n\nDividing when you should multiply, or using the inverse exchange rate, generates absurd values that may go unnoticed without balance checks.\n\n### 3. Ignoring fees\n\nFees are deductible expenses that reduce your capital gain. A dataset where fees have been lost produces a return that pays more tax than is due.\n\n### 4. Classifying internal movements as sales\n\nMovements between your own exchanges and wallets are not taxable. If they are classified as sales, they generate fictitious capital gains that you should not be paying.\n\nIf you are not confident about any part of the process, our [tax advisory team specialized in cryptocurrencies](/servicios/asesoria-fiscal-criptomonedas) can review your work and detect issues before they impact your tax return.\n\n---\n\n## Conclusion: clean data, correct tax return\n\nCleaning cryptocurrency datasets is not an optional step or a cosmetic improvement. It is a fundamental requirement for obtaining an accurate tax return that complies with AEAT requirements and that you can defend in the event of an inquiry. A dirty dataset will produce incorrect results regardless of the quality of the software or calculation methodology you use afterwards.\n\nThe entire process requires time, attention to detail, and knowledge of both cryptocurrency trading and Spanish tax requirements. For users with simple trading and few transactions, following this guide should be enough. For complex activity with multiple exchanges, significant DeFi operations, or thousands of transactions, professional assistance can save time and prevent costly errors.\n\nAt Cleriontax we combine experience in cryptocurrency taxation with rigorous data engineering methodologies to ensure that every report we prepare is based on verified and traceable data. If you prefer to delegate this technical process, our [specialized services](/servicios) are designed exactly for that.\n\n**Your next step:** If you have already exported your data and need help with cleaning, consolidation, or tax calculations, [contact our team](/contacto) for a no-obligation initial assessment. If you are still in the export phase, visit our [blog](/blog) where you will find specific guides for each exchange and wallet.\n\n---\n\n**Disclaimer:** This article is for informational and educational purposes only. It does not constitute personalized tax advice. Tax regulations are subject to change and each personal situation is unique. Always consult a professional tax advisor before making tax decisions.\n\n---\n\n*Last updated: December 2025*\n\n*Published by: Cleriontax Team â€“ Experts in Crypto Taxation and Data Analysis*"
}
